name: p7zip
no-autogen: true
make-args:
    - all2
    - OPTFLAGS=-O2 -g
    - DEST_HOME=/app
    - DEST_BIN=/app/bin
    - DEST_SHARE=/app/lib/p7zip
    - DEST_MAN=/app/share/man
make-install-args:
    - DEST_HOME=/app
    - DEST_BIN=/app/bin
    - DEST_SHARE=/app/lib/p7zip
    - DEST_MAN=/app/share/man
sources:
    - type: git
      url: https://github.com/jinfeihan57/p7zip
      commit: 0b5b1b1a866d0e41cb7945e60a32262874e724aa
      disable-shallow-clone: true
    - type: shell
      commands:
        - git cherry-pick -n -Xours c104127e6a93
    - type: shell
      only-arches:
        - x86_64
      commands:
        - ln -sf makefile.linux_amd64_asm makefile.machine
modules:
    - name: yasm
      buildsystem: cmake-ninja
      sources:
        - type: archive
          url: https://github.com/yasm/yasm/archive/v1.3.0.tar.gz
          sha256: f708be0b7b8c59bc1dbe7134153cd2f31faeebaa8eec48676c10f972a1f13df3
      cleanup:
        - '*'
